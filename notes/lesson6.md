# Modules and Classes


## 6.1 Build Your First Module

```
[root@training ~/puppetcode:master]# cd /root/puppetcode/modules/
[root@training ~/puppetcode/modules:master]# mkdir -p users/manifests
[root@training ~/puppetcode/modules:master]# vi users/manifests/init.pp
```

### Edit

```
class users {
  user { 'fundamentals':
    ensure     => present,
    home       => '/home/fundamentals',
    managehome => true,
  }
}
```

### Validate and Edit 

```
[root@training ~/puppetcode/modules:master±]# puppet parser validate users/manifests/init.pp 
[root@training ~/puppetcode/modules:master±]# mkdir users/tests
[root@training ~/puppetcode/modules:master±]# puppet parser validate users/tests/init.pp 
```

### vi modules/users/tests/init.pp

```
include users
```

### puppet apply --noop users/tests/init.pp

```
Notice: Compiled catalog for spark.puppetlabs.vm in environment production in 0.11 seconds
Notice: /Stage[main]/Users/User[fundamentals]/ensure: current_value absent, should be present (noop)
Notice: Class[Users]: Would have triggered 'refresh' from 1 events
Notice: Stage[main]: Would have triggered 'refresh' from 1 events
Notice: Finished catalog run in 0.12 seconds
```

### puppet apply users/tests/init.pp 

```
Notice: Compiled catalog for spark.puppetlabs.vm in environment production in 0.12 seconds
Notice: /Stage[main]/Users/User[fundamentals]/ensure: created
Notice: Finished catalog run in 0.18 seconds
```

### [root@training ~/puppetcode/modules:master±]# tree

```
.
└── users
    ├── manifests
    │   └── init.pp
    └── tests
        └── init.pp

3 directories, 2 files
```

## Lab 6.3 Expand Your Module

```
[root@training ~/puppetcode/modules:master±]# cat users/manifests/admins.pp 
class users::admins {
  group { 'staff':
    ensure => present,
    gid    => '1337',
  }
  user { 'admin':
    ensure => present,
    gid    => 'staff',
    shell  => '/bin/csh',
  }
}

[root@training ~/puppetcode/modules:master±]# cat users/tests/admins.pp 
include users::admins

[root@training ~/puppetcode/modules:master±]# tree
.
└── users
    ├── manifests
    │   ├── admins.pp
    │   └── init.pp
    └── tests
        ├── admins.pp
        └── init.pp

3 directories, 4 files

[root@training ~/puppetcode/modules:master±]# puppet parser validate users/manifests/admins.pp 
```


### puppet apply --noop users/tests/admins.pp 

```
Notice: Compiled catalog for spark.puppetlabs.vm in environment production in 0.17 seconds
Notice: /Stage[main]/Users::Admins/Group[staff]/ensure: current_value absent, should be present (noop)
Notice: /Stage[main]/Users::Admins/User[admin]/ensure: current_value absent, should be present (noop)
Notice: Class[Users::Admins]: Would have triggered 'refresh' from 2 events
Notice: Stage[main]: Would have triggered 'refresh' from 1 events
Notice: Finished catalog run in 0.10 seconds
```

### puppet apply users/tests/admins.pp 

```
Notice: Compiled catalog for spark.puppetlabs.vm in environment production in 0.17 seconds
Notice: /Stage[main]/Users::Admins/Group[staff]/ensure: created
Notice: /Stage[main]/Users::Admins/User[admin]/ensure: created
Notice: Finished catalog run in 0.23 seconds
```

### Lab 8.1

```
[root@training ~/puppetcode:master]# cd modules/
[root@training ~/puppetcode/modules:master]# mkdir -p hosts/{manifests,tests}
[root@training ~/puppetcode/modules:master]# vi hosts/manifests/init.pp
[root@training ~/puppetcode/modules:master±]# vi hosts/tests/init.pp
[root@training ~/puppetcode/modules:master±]# vi hosts/tests/init.pp
[root@training ~/puppetcode/modules:master±]# 
[root@training ~/puppetcode/modules:master±]# puppet parser validate hosts/manifests/init.pp 
[root@training ~/puppetcode/modules:master±]# puppet parser validate hosts/tests/init.pp 
```

### cat hosts/manifests/init.pp

```
class hosts {
  host { 'testing.puppetlabs.vm':
    ip     => '127.0.0.1',
    ensure => present,
  }
}
```

### cat hosts/tests/init.pp

```
require hosts
```

### puppet apply --noop hosts/tests/init.pp

```
Notice: Compiled catalog for spark.puppetlabs.vm in environment production in 0.08 seconds
Notice: /Stage[main]/Hosts/Host[testing.puppetlabs.vm]/ensure: current_value absent, should be present (noop)
Notice: Class[Hosts]: Would have triggered 'refresh' from 1 events
Notice: Stage[main]: Would have triggered 'refresh' from 1 events
Notice: Finished catalog run in 0.10 seconds
```

### puppet apply hosts/tests/init.pp 

```
Notice: Compiled catalog for spark.puppetlabs.vm in environment production in 0.05 seconds
Notice: /Stage[main]/Hosts/Host[testing.puppetlabs.vm]/ensure: created
Notice: Finished catalog run in 0.10 seconds
```

### cat /etc/hosts

```
# HEADER: This file was autogenerated at 2014-08-12 22:51:08 +0000
# HEADER: by puppet.  While it can still be managed manually, it
# HEADER: is definitely not recommended.
127.0.0.1 training.puppetlabs.vm  training localhost localhost.localdomain
::1 localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.168.62  master.puppetlabs.vm  master
192.168.168.59  spark.puppetlabs.vm spark
127.0.0.1 testing.puppetlabs.vm
```

### [root@training ~/puppetcode/modules:master±]# tree

```
.
├── hosts
│   ├── manifests
│   │   └── init.pp
│   └── tests
│       └── init.pp
└── users
    ├── manifests
    │   ├── admins.pp
    │   └── init.pp
    └── tests
        ├── admins.pp
        └── init.pp

6 directories, 6 files
```


